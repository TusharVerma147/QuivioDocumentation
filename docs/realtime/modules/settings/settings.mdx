
# Settings

The Settings Screen is a React Native component that provides users with various configuration options related to their account and site preferences. It allows users to update their location, view important policies, and log out. The component is highly interactive, integrating with APIs for data retrieval and updating user preferences dynamically. This document outlines the key features, structure, and functionality of the Settings Screen.

<figure> <img src="/img/inventory/settings.png" alt="This is an example image  of Settings Screen" width="300" height="600" /></figure>

## Overview

The Settings Screen allows users to:

- Select and update their preferred site.
- View and interact with privacy policy, terms & conditions, and about us information.
- Log out of the application securely.
- Dynamically update the header image based on the time of day.
- Perform site location updates with API integration.
- Search for a site by name or site ID.

## Key Features

- **Site Selection**: Users can select a site from a list of available locations. The currently selected site is highlighted and can be updated.
- **Policy Information**: Users can view the About Us, Privacy Policy, and Terms & Conditions directly from the app using an embedded web view.
- **Logout**: Provides an interactive logout process that includes a confirmation modal.
- **Dynamic Header**: The header image and color change based on the time of day to provide a customized experience.
- **API Integration**: The screen interacts with various APIs to fetch location data and perform user-related actions like saving the selected site or logging out.
- **Site Location Update**: Allows users to update their preferred site and save the changes via API integration.
- **Search Functionality**: A search bar allows users to filter and find a specific site based on its name, code, or site ID.


## Code Structure

### Imports

The screen imports several utilities and components, such as:

- **Custom Components**: CustomButton, GeneralHeader, SearchInput, LogOut, CustomLoader.
- **Hooks**: useAppSelector, useAppThunkDispatch, useSimpleReducer.
- **Redux**: logoutApi, clearToken, saveSiteList.
- **Services**: AnalyticsService, ModalController.
- **Utilities**: colors, regex, screenNames, getHp, getWp, showSnackBar.
- **Third-party Libraries**: ImageBackground, ScrollView, FlatList, WebView, ActivityIndicator.

### State Management

The screen uses the useSimpleReducer hook to manage the component's state:

```javascript
const initialState = {
  data: [],
  headerImage: '',
  searchQuery: '',
  selectedSite: {},
  isLoading: false,
  isModalVisible: false,
  selectedItem: SettingsData[0],
};

const [state, updateState] = useSimpleReducer({
  ...initialState,
  selectedSite: selectedLocation,
});
```

### Event Handlers

- **getData**: Fetches the site data and updates the state with the list of available locations.
- **onPressLogout**:   Handles the logout process by calling the logoutApi and clearing the userâ€™s token.
- **onPressOption**:  Opens different screens or displays modals depending on the selected option (e.g., site list, about us, privacy policy).
- **saveSiteLocation**: Sends the selected site data to the backend for saving using the saveSiteList API call.
- **updateHeaderStyle**: Dynamically updates the header image and color based on the current time of day (morning/evening).



### API Integration

- **logoutApi**: Logs out the user and clears their authentication token.
- **saveSiteList**: Saves the selected site location through an API request.
- **getLocationData**: Fetches the list of locations from the API.


### Analytics

The component tracks user interactions and logs events using AnalyticsService:

```javascript
AnalyticsService.logEvent(EVENTS.LOGOUT_SUCCESS);
AnalyticsService.logEvent(EVENTS.LOGOUT_CLICK);
```

### Custom Hooks

- **useBackHandler**: Handles Android back button press to show a confirmation message before exiting the app.

### Dynamic Header Styling

The header image and color are updated based on the current time using the updateHeaderStyle function.The header image and color are dynamically updated based on the time of day. If it's evening (after 8 PM) or early morning (before 6 AM), the header adopts a darker theme; otherwise, it uses a lighter theme. This is achieved by the updateHeaderStyle function:


```javascript
const updateHeaderStyle = () => {
  const hour = new Date().getHours();
  if (hour >= 20 || hour < 6) {
    updateState({ headerImage: images.headerDarkBgImage, headerColor: colors.lightGray74 });
  } else {
    updateState({ headerImage: images.headerBgImage, headerColor: colors.lightBlue });
  }
};
```


## Modal and Navigation

- **LogOut Modal**: When the user selects the logout option, a modal is displayed with options to confirm or cancel the logout action.
- **WebView Navigation**: The About Us and Terms & Policies are opened within a WebView, where users can read the full documents. The WebView is also integrated with loading indicators.
- **getLocationData**: Fetches the list of locations from the API.


## Modal and Navigation

Users can navigate to the following screens from the Settings screen:

- **Site Listing**: Users can update their site by selecting from a list of available sites.
- **About Us**: This includes options to view the About Us with navigation to about us screen.
- **Terms & Policies**: This includes options to view the Terms & Policies with navigation to Terms & Policies screen.
- **Logout**: A modal appears when users choose to log out, and they can confirm the action or cancel it.

## Conclusion

The Settings Screen offers a wide array of user preferences and configuration options, from site selection and viewing legal policies to logging out. It integrates smoothly with external APIs for data fetching and updates, providing a seamless experience. Dynamic UI changes based on the time of day and location selection help enhance user engagement and personalization.








